# Vertex v5 (Monolith)

**Full-Stack Academic Dashboard & Scraper**

Vertex v5 is a fully containerized academic dashboard optimized for self-hosted deployment. It combines a **Go Fiber backend** (Goscraper) that dynamically parses SRM Academia data with a **Next.js 15 frontend** exported statically for high performance.

##  Architecture

This repository packages a unified application designed for same-origin deployment:

  * **Frontend:** Next.js 15 app (App Router) configured for static export (`output: "export"`), utilizing client-side routing.
  * **Backend:** Go 1.21 Fiber service providing REST API endpoints, scraping logic, and database utilities.
  * **Docker:** A multi-stage build that compiles the Go service, builds the static frontend, and serves both from a single Alpine image.

##  Repository Layout

  * **`frontend/`** – Next.js application containing client-only pages, mock data helpers, and React Query stores.
  * **`backend/`** – Go service containing API routes, scraping logic, and middleware.
  * **`Dockerfile`** – Unified container builder that serves the app on port `7860`.

-----

##  Prerequisites & Database Setup

### 1\. Supabase Configuration

You must set up the following tables in your Supabase project before running the application.

**Create the `goscrape` table:**

```sql
create table public.goscrape (
  "regNumber" text not null,
  "user" text null,
  timetable text null,
  courses text null,
  attendance text null,
  marks text null,
  "lastUpdated" numeric null,
  token text not null,
  ophour text null default ''::text,
  constraint goscrape_pkey primary key ("regNumber", token),
  constraint goscrape_regNumber_key unique ("regNumber")
);
```

**Create the `gocal` table:**

```sql
create table public.gocal (
  id bigint generated by default as identity not null,
  date text null,
  month text null,
  day text null,
  "order" text null,
  event text null,
  created_at numeric null
);
```

### 2\. CRON Jobs

Enable the `pg_cron` extension in Supabase and schedule the following maintenance jobs.

**Delete old user data:**

```sql
UPDATE goscrape
SET "user" = NULL, timetable = NULL, attendance = NULL, marks = NULL, courses = NULL
WHERE "lastUpdated" < (EXTRACT(EPOCH FROM NOW()) * 1000) - (12 * 60 * 60 * 1000);
```

**Delete old calendar events:**

```sql
CREATE OR REPLACE FUNCTION delete_from_gocal()
RETURNS void AS $$
BEGIN
    DELETE FROM gocal;
END;
$$ LANGUAGE plpgsql SECURITY INVOKER;

select
  cron.schedule (
    '0 0 * * *',
    'SELECT delete_old_calendar_events()'
  );
```

-----

##  Local Development

Ensure `.env` and `.env.local` are configured correctly in their respective directories.

### Backend

1.  Navigate to the backend folder:
    ```bash
    cd backend
    go mod tidy
    ```
2.  Run the server (ensure `globals/DevMode.go` is configured appropriately):
    ```bash
    PORT=7860 go run ./src
    ```

### Frontend

1.  Navigate to the frontend folder:
    ```bash
    cd frontend
    npm install
    npm run dev
    ```
2.  To produce the static bundle locally:
    ```bash
    npm run build:static
    ```
    Artifacts will be generated in `frontend/out/`.

-----

##  Docker Quickstart

You can build and run the unified container locally using the following workflow.

1.  **Build the image:**
    ```bash
    docker build -t vertex-app .
    ```
2.  **Run the container:**
    ```bash
    docker run --rm -p 7860:7860 vertex-app
    ```
3.  **Verify:**
      * App: `http://localhost:7860/`
      * Health Check: `http://localhost:7860/healthz`.

-----

## Health Checks

  * `GET /healthz` – Lightweight readiness endpoint served directly by the Go app.
  * `GET /api/health` – API health endpoint (verifies database/auth connections).

## ❤️ Credits

Originally built by @StealthTensor.

### GitHub Description

> All-in-one containerized deployment of the Vertex project (Go backend + Next.js frontend) for self-hosted, same-origin hosting. Includes Dockerfile, environment setup, and deployment docs.
